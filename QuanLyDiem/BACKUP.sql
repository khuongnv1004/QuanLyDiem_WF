CREATE DATABASE QLHocSinhTHPT_1

USE QLHocSinhTHPT_1
GO

CREATE TABLE  NGUOIDUNG
(
	MaND 		VARCHAR (6) 	NOT NULL	PRIMARY KEY,
	TenND		NVARCHAR (30)	NOT NULL,
	TenDNhap	VARCHAR (30)	NOT NULL,
	MatKhau		VARCHAR (30)	NOT NULL,
)

INSERT INTO NGUOIDUNG VALUES('ND0001','Nguyen Van Khuong',	'admin',		'vankhuong')
INSERT INTO NGUOIDUNG VALUES('ND0002','Le Huu Thang',		'huuthang',		'huuthang')
INSERT INTO NGUOIDUNG VALUES('ND0003','Nguyen Van Duc',		'vanduc',		'vanduc')

CREATE TABLE DANTOC
(
	MaDanToc	VARCHAR (6)		NOT NULL	PRIMARY KEY,
	TenDanToc	NVARCHAR (30)	NOT NULL
)

INSERT INTO DANTOC VALUES('DT0001','Kinh')
INSERT INTO DANTOC VALUES('DT0002','Hoa')
INSERT INTO DANTOC VALUES('DT0003','Khome')
INSERT INTO DANTOC VALUES('DT0004','Cham')

CREATE TABLE TONGIAO
(
	MaTonGiao	VARCHAR (6)		NOT NULL	PRIMARY KEY,
	TenTonGiao	NVARCHAR (30)	NOT NULL
)

INSERT INTO TONGIAO VALUES('TG0001','Khong')
INSERT INTO TONGIAO VALUES('TG0002','Phat')
INSERT INTO TONGIAO VALUES('TG0003','PG Hoa Hao')
INSERT INTO TONGIAO VALUES('TG0004','Thien Chua')
INSERT INTO TONGIAO VALUES('TG0005','Tin Lanh')

CREATE TABLE NAMHOC
(
	MaNamHoc	VARCHAR (6)		NOT NULL	PRIMARY KEY,
	TenNamHoc	VARCHAR (30)	NOT NULL
)

INSERT INTO NAMHOC VALUES('NH1920','2019 - 2020')
INSERT INTO NAMHOC VALUES('NH2021','2020 - 2021')

CREATE TABLE HOCKY
(
	MaHocKy		VARCHAR (3)		NOT NULL	PRIMARY KEY,
	TenHocKy	NVARCHAR (30)	NOT NULL,
	HeSo		INT
)

INSERT INTO HOCKY VALUES('HK1','Hoc ky 1', 1)
INSERT INTO HOCKY VALUES('HK2','Hoc ky 2', 2)

CREATE TABLE KHOILOP
(
	MaKhoiLop	VARCHAR (6)		NOT NULL	PRIMARY KEY,
	TenKhoiLop	NVARCHAR (30)	NOT NULL
)

INSERT INTO KHOILOP VALUES('KHOI10','Khoi 10')
INSERT INTO KHOILOP VALUES('KHOI11','Khoi 11')
INSERT INTO KHOILOP VALUES('KHOI12','Khoi 12')

CREATE TABLE MONHOC
(
	MaMonHoc	VARCHAR (6)		NOT NULL	PRIMARY KEY,
	TenMonHoc	NVARCHAR (30)	NOT NULL,
	SoTiet		INT				NOT NULL,
	HeSo		INT				NOT NULL
)

INSERT INTO MONHOC VALUES('MH0001','Toan Hoc',		90,	2)
INSERT INTO MONHOC VALUES('MH0002','Vat Ly',		60,	1)
INSERT INTO MONHOC VALUES('MH0003','Hoa Hoc',		60,	1)
INSERT INTO MONHOC VALUES('MH0004','Sinh Hoc',		60,	1)
INSERT INTO MONHOC VALUES('MH0005','Ngu Van',		90,	2)
INSERT INTO MONHOC VALUES('MH0006','Lich Su',		45,	1)
INSERT INTO MONHOC VALUES('MH0007','Dia Ly',		45,	1)
INSERT INTO MONHOC VALUES('MH0008','Tieng Anh',		45,	1)
INSERT INTO MONHOC VALUES('MH0009','GD Cong Dan',	30,	1)
INSERT INTO MONHOC VALUES('MH0010','Tin Hoc',		30,	1)
INSERT INTO MONHOC VALUES('MH0011','The Duc',		30,	1)
INSERT INTO MONHOC VALUES('MH0012','Quoc Phong',	30,	1)
INSERT INTO MONHOC VALUES('MH0013','Cong Nghe',		30,	1)

CREATE TABLE HOCLUC
(
	MaHocLuc		VARCHAR (6)		NOT NULL	PRIMARY KEY,
	TenHocLuc		NVARCHAR (30)	NOT NULL,
	DiemCanDuoi		FLOAT			NOT NULL,
	DiemCanTren		FLOAT			NOT NULL,
	DiemKhongChe	FLOAT			NOT NULL
)

INSERT INTO HOCLUC VALUES('HL0001','Gioi',		8.0,	10.0,	6.5)
INSERT INTO HOCLUC VALUES('HL0002','Kha',		6.5,	7.9,	5.0)
INSERT INTO HOCLUC VALUES('HL0003','Trung binh',5.0,	6.4,	3.5)
INSERT INTO HOCLUC VALUES('HL0004','Yeu',		3.5,	4.9,	2.0)
INSERT INTO HOCLUC VALUES('HL0005','Kem',		0.0,	3.4,	0.0)

CREATE TABLE HANHKIEM
(
	MaHanhKiem		VARCHAR (6)		NOT NULL	PRIMARY KEY,
	TenHanhKiem		NVARCHAR (30)	NOT NULL
)

INSERT INTO HANHKIEM VALUES('HK0001','Tot')
INSERT INTO HANHKIEM VALUES('HK0002','Kha')
INSERT INTO HANHKIEM VALUES('HK0003','Trung binh')
INSERT INTO HANHKIEM VALUES('HK0004','Yeu')

CREATE TABLE GIAOVIEN
(
	MaGiaoVien	VARCHAR (6)		NOT NULL	PRIMARY KEY,
	TenGiaoVien NVARCHAR (30)	NOT NULL,
	DiaChi		NVARCHAR (50)	NOT NULL,
	DienThoai	VARCHAR (15)	NOT NULL,
	MaMonHoc	VARCHAR (6)		NOT NULL,
	CONSTRAINT F_GV_MH FOREIGN KEY(MaMonHoc)	REFERENCES MONHOC(MaMonHoc)
)

INSERT INTO GIAOVIEN VALUES('GV0001','Nong Van Hoat',		'Ha Noi',		'0975058876','MH0001')
INSERT INTO GIAOVIEN VALUES('GV0002','Vuong Cong Quang',	'Ha Noi',		'0976630315','MH0002')
INSERT INTO GIAOVIEN VALUES('GV0003','Nguyen Van Khuong',	'Ha Noi',		'0699015456','MH0003')
INSERT INTO GIAOVIEN VALUES('GV0004','Le Huu Thang',		'Hung Yen',		'0845241566','MH0004')
INSERT INTO GIAOVIEN VALUES('GV0005','Nguyen Van Duc',		'Bac Giang',	'0123456789','MH0005')
INSERT INTO GIAOVIEN VALUES('GV0006','Le Thi Minh Nguyet',	'Ha Noi',		'0987684785','MH0006')
INSERT INTO GIAOVIEN VALUES('GV0007','Nguyen Tien Minh',	'Ha Noi',		'0367830409','MH0007')
INSERT INTO GIAOVIEN VALUES('GV0008','Phan Duc Thanh',		'Ha Noi',		'0335678938','MH0008')
INSERT INTO GIAOVIEN VALUES('GV0009','Hoang Thi Thu',		'Ha Noi',		'0357683947','MH0009')


CREATE TABLE HOCSINH
(
	MaHocSinh		VARCHAR (6)		NOT NULL	PRIMARY KEY,
	HoTen			NVARCHAR (30)	NOT NULL,
	GioiTinh		NVARCHAR(5)		NOT NULL,
	NgaySinh		DATETIME,
	NoiSinh			NVARCHAR (50)	NOT NULL,
	MaDanToc		VARCHAR (6)		NOT NULL,
	MaTonGiao		VARCHAR (6)		NOT NULL,
	HoTenCha		NVARCHAR (30)	NOT NULL,
	HoTenMe			NVARCHAR (30)	NOT NULL,
	
	CONSTRAINT F_HS_DT	FOREIGN KEY(MaDanToc)		REFERENCES DANTOC(MaDanToc),
	CONSTRAINT F_HS_TG	FOREIGN KEY(MaTonGiao)		REFERENCES TONGIAO(MaTonGiao)

)

INSERT INTO HOCSINH VALUES('HS0001','Nguyen Van Tu',		'Nam','01/02/2003','Ha Noi',	'DT0001','TG0001','Nguyen Van Binh','Le Thi Linh')
INSERT INTO HOCSINH VALUES('HS0002','Nguyen Ngoc An',		'Nam','01/02/2004','Ha Noi',	'DT0001','TG0002','Nguyen Ngoc Canh','Phan Huong')
INSERT INTO HOCSINH VALUES('HS0003','Le Hoang Anh',			'Nam','04/15/2005','Ha Noi',	'DT0001','TG0003','Le Hoang Chinh',	'Nguyen Khanh Linh')
INSERT INTO HOCSINH VALUES('HS0004','Huynh Thien Chi',		'Nam','01/02/2003','Ha Noi',	'DT0001','TG0004','Huynh Thien Ha',	'Hoang Ha Anh ')
INSERT INTO HOCSINH VALUES('HS0005','Ly Ngoc Duy',			'Nam','01/02/2003','Ha Noi',	'DT0001','TG0005','Ly Ngoc Thang',	'Nguyen Thi Bich')
INSERT INTO HOCSINH VALUES('HS0006','Huynh Ngoc Diep',		'Nu','01/02/2004','Ha Noi',		'DT0001','TG0001','Huynh Ngoc Tung','Ngo Anh Ngoc'	)
INSERT INTO HOCSINH VALUES('HS0007','Tran Thi Hue',			'Nu','04/15/2004','Ha Noi',		'DT0001','TG0002','Tran Van Tuan',	'Le Bao Ngoc'	)
INSERT INTO HOCSINH VALUES('HS0008','Nguyen Thanh Huy',		'Nam','01/02/2005','Ha Noi',	'DT0001','TG0003','Nguyen Thanh Duy','Phung Khanh Huyen')

CREATE TABLE LOP
(
	MaLop		VARCHAR (10)	NOT NULL	PRIMARY KEY,
	TenLop		NVARCHAR (30)	NOT NULL,
	MaKhoiLop	VARCHAR (6)		NOT NULL,
	MaNamHoc	VARCHAR (6)		NOT NULL,
	MaGiaoVien	VARCHAR (6)		NOT NULL,
	
	CONSTRAINT F_LOP_KL FOREIGN KEY(MaKhoiLop)	REFERENCES KHOILOP(MaKhoiLop),
	CONSTRAINT F_LOP_NH FOREIGN KEY(MaNamHoc)	REFERENCES NAMHOC(MaNamHoc),
	CONSTRAINT F_LOP_GV FOREIGN KEY(MaGiaoVien)	REFERENCES GIAOVIEN(MaGiaoVien)
)

INSERT INTO LOP VALUES('LOP1011920','10A1','KHOI10','NH1920', 'GV0006')
INSERT INTO LOP VALUES('LOP1021920','10A2','KHOI10','NH1920', 'GV0005')
INSERT INTO LOP VALUES('LOP1031920','10A3','KHOI10','NH1920', 'GV0004')
INSERT INTO LOP VALUES('LOP1111920','11A1','KHOI11','NH1920', 'GV0003')
INSERT INTO LOP VALUES('LOP1121920','11A2','KHOI11','NH1920', 'GV0002')
INSERT INTO LOP VALUES('LOP1131920','11A3','KHOI11','NH1920', 'GV0007')
INSERT INTO LOP VALUES('LOP1211920','12A1','KHOI12','NH1920', 'GV0001')
INSERT INTO LOP VALUES('LOP1221920','12A2','KHOI12','NH1920', 'GV0008')
INSERT INTO LOP VALUES('LOP1231920','12A3','KHOI12','NH1920', 'GV0009')


CREATE TABLE PHANLOP
(
	MaNamHoc	VARCHAR (6)		NOT NULL,
	MaKhoiLop	VARCHAR (6)		NOT NULL,
	MaLop		VARCHAR (10)	NOT NULL,
	MaHocSinh	VARCHAR (6)		NOT NULL,
	PRIMARY KEY(MaNamHoc, MaKhoiLop, MaLop, MaHocSinh),
	CONSTRAINT F_PL_NH		FOREIGN KEY(MaNamHoc)	REFERENCES NAMHOC(MaNamHoc),
	CONSTRAINT F_PL_KHOI	FOREIGN KEY(MaKhoiLop)	REFERENCES KHOILOP(MaKhoiLop),
	CONSTRAINT F_PL_LOP		FOREIGN KEY(MaLop)		REFERENCES LOP(MaLop),
	CONSTRAINT F_PL_HS		FOREIGN KEY(MaHocSinh)	REFERENCES HOCSINH(MaHocSinh)
)

INSERT INTO PHANLOP VALUES('NH1920','KHOI10','LOP1011920','HS0003')
INSERT INTO PHANLOP VALUES('NH1920','KHOI10','LOP1011920','HS0008')
INSERT INTO PHANLOP VALUES('NH1920','KHOI11','LOP1111920','HS0002')
INSERT INTO PHANLOP VALUES('NH1920','KHOI11','LOP1121920','HS0006')
INSERT INTO PHANLOP VALUES('NH1920','KHOI11','LOP1131920','HS0007')
INSERT INTO PHANLOP VALUES('NH1920','KHOI12','LOP1211920','HS0001')
INSERT INTO PHANLOP VALUES('NH1920','KHOI12','LOP1221920','HS0005')
INSERT INTO PHANLOP VALUES('NH1920','KHOI12','LOP1231920','HS0004')



CREATE TABLE DIEM
(
	STT			INT				PRIMARY KEY,
	MaHocSinh	VARCHAR (6)		NOT NULL,
	MaMonHoc	VARCHAR (6)		NOT NULL,
	MaHocKy		VARCHAR (3)		NOT NULL,
	MaNamHoc	VARCHAR (6)		NOT NULL,
	MaLop		VARCHAR (10)	NOT NULL,
	DiemMieng	FLOAT			NOT NULL,
	Diem15		FLOAT			NOT NULL,
	DiemKT		FLOAT			NOT NULL,
	DiemThi		FLOAT			NOT NULL,
	DiemTB		FLOAT					
	CONSTRAINT F_DIEM_HS	FOREIGN KEY(MaHocSinh)	REFERENCES HOCSINH(MaHocSinh),
	CONSTRAINT F_DIEM_MH	FOREIGN KEY(MaMonHoc)	REFERENCES MONHOC(MaMonHoc),
	CONSTRAINT F_DIEM_HK	FOREIGN KEY(MaHocKy)	REFERENCES HOCKY(MaHocKy),
	CONSTRAINT F_DIEM_NH	FOREIGN KEY(MaNamHoc)	REFERENCES NAMHOC(MaNamHoc),
	CONSTRAINT F_DIEM_LOP	FOREIGN KEY(MaLop)		REFERENCES LOP(MaLop),
)


CREATE TABLE KQ_HOC_KY_TONG_HOP
(
	MaHocSinh	VARCHAR (6)		NOT NULL,
	MaLop		VARCHAR (10)	NOT NULL,
	MaHocKy		VARCHAR (3)		NOT NULL,
	MaNamHoc	VARCHAR (6)		NOT NULL,
	MaHocLuc	VARCHAR (6)		NOT NULL,
	MaHanhKiem	VARCHAR (6)		NOT NULL,
	DiemTB		FLOAT,						
	PRIMARY KEY(MaHocSinh, MaHocKy, MaLop, MaNamHoc),
	CONSTRAINT F_KQHK_HS	FOREIGN KEY(MaHocSinh)		REFERENCES HOCSINH(MaHocSinh),
	CONSTRAINT F_KQHK_LOP	FOREIGN KEY(MaLop)			REFERENCES LOP(MaLop),
	CONSTRAINT F_KQHK_HK	FOREIGN KEY(MaHocKy)		REFERENCES HOCKY(MaHocKy),
	CONSTRAINT F_KQHK_NH	FOREIGN KEY(MaNamHoc)		REFERENCES NAMHOC(MaNamHoc),
	CONSTRAINT F_KQHK_HL	FOREIGN KEY(MaHocLuc)		REFERENCES HOCLUC(MaHocLuc),
	CONSTRAINT F_KQHK_HKIEM	FOREIGN KEY(MaHanhKiem)		REFERENCES HANHKIEM(MaHanhKiem),
)

CREATE TABLE KQ_CA_NAM_TONG_HOP
(
	MaHocSinh	VARCHAR (6)		NOT NULL,
	MaLop		VARCHAR (10)	NOT NULL,
	MaNamHoc	VARCHAR (6)		NOT NULL,
	MaHocLuc	VARCHAR (6)		NOT NULL,
	MaHanhKiem	VARCHAR (6)		NOT NULL,
	DTBCaNam	FLOAT			NOT NULL,
	PRIMARY KEY(MaHocSinh, MaLop, MaNamHoc),
	CONSTRAINT F_KQCN_HS	FOREIGN KEY(MaHocSinh)		REFERENCES HOCSINH(MaHocSinh),
	CONSTRAINT F_KQCN_LOP	FOREIGN KEY(MaLop)			REFERENCES LOP(MaLop),
	CONSTRAINT F_KQCN_NH	FOREIGN KEY(MaNamHoc)		REFERENCES NAMHOC(MaNamHoc),
	CONSTRAINT F_KQCN_HL	FOREIGN KEY(MaHocLuc)		REFERENCES HOCLUC(MaHocLuc),
	CONSTRAINT F_KQCN_HKIEM	FOREIGN KEY(MaHanhKiem)		REFERENCES HANHKIEM(MaHanhKiem)
)
